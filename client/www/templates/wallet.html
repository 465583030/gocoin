<script>
function switchwallet(fn) {
	document.location='?sid='+sid+'&wal='+encodeURIComponent(fn)
}
function switch2wallet(idx) {
	var tr = document.getElementById('walrow'+idx)
	var wal = tr.cells[1].innerText
	document.location='?sid='+sid+'&wal='+encodeURIComponent(wal)
}
function shwwal() {
	if (webWalletSelected()) {
		var name = qswal.options[qswal.selectedIndex].text
		walletdata.value = localStorage.getItem("gocoinWal_"+name)
	}
	showwal.style.display='none'
	formwal.style.display='block'
}
function setunused(idx) {
	var tr = document.getElementById('walrow'+idx)
	var adr = tr.cells[0].innerText
	var lab = tr.cells[2].innerText
	var wal = tr.cells[1].innerText
	if (confirm("Move " + adr + " (" + lab + ") from wallet " + wal + "to UNUSED?")) {
		document.location='?sid='+sid+'&setunused='+idx
	}
}
function edit_label(idx) {
	var tr = document.getElementById('walrow'+idx)
	var adr = tr.cells[0].innerText
	var lab = tr.cells[2].innerText
	var wal = tr.cells[1].innerText
	var newlab = prompt("Edit label in " + wal + " for:\n" + adr, lab)
	if (newlab) {
		document.location='?sid='+sid+'&setlabel='+idx+'&lab='+encodeURIComponent(newlab)
	}
}
function close_editor() {
	showwal.style.display='block'
	formwal.style.display='none'
}
function save_web_wallet() {
	var name = walletfname.value
	var names = localStorage.gocoinWallets.split('|')
	var i;
	for (i=0; i<names.length; i++) {
		if (names[i]==name) {
			break
		}
	}
	if (i==names.length) {
		localStorage.gocoinWallets += '|'+name
		var o = document.createElement("option")
		o.text = name
		qswal.add(o)
	}
	localStorage.setItem("gocoinWal_"+name, walletdata.value)
	console.log("saved web wallet as "+name)
	close_editor()

	// select saved wallet now
			if (localStorage.gocoinWalletSelected==names[i]) {
				qswal.selectedIndex = qswal.length-1
			}
}
function del_webwallet() {
	var name = walletfname.value
	localStorage.removeItem("gocoinWal_"+name)
	document.location.reload()
}
</script>
<h2>Your wallet</h2>
Balance: <b>{TOTAL_BTC}</b> BTC in <b>{UNSPENT_OUTS}</b> outputs (<a href="balance.zip">balance.zip</a>)<br>
<br>
Wallet filename: <b class="mono"><!--WALLET_FILENAME--></b><br>
<br>
Switch wallet: <!--ONEWALLET-->
<br>

<hr>
<div id="showwal">
<h2>Current wallet
<input style="float:right" type="button" value="Edit" onclick="shwwal()"></h2>
<table class="wal bord">
<tr>
<th>Address
<th align="left">Wallet
<th align="left">Label
<th align="left">Multi
<th colspan="2">Balance&nbsp;BTC
<!--ONE_WALLET_ADDR-->
</table>
</div>


<div id="formwal" style="display:none">
<h2>Edit wallet</h2>
<table width="90%">
<form method="post" action="cfg">
<tr><td colspan="2">
	<textarea name="walletdata" id="walletdata" style="width:100%" rows="25">{WALLET_DATA}</textarea><br>
	<i>
	Empty lines are ignored.<br>
	Put <b>#</b> character in front of a line, to comment it out.<br>
	Put <b>@</b> character followed by filename in front of a line, to include content of another wallet.<br>
	</i>
<tr>
	<td align="left">
		File Name: <input type="edit" id="walletfname" name="walletfname" value="{WALLET_NAME}" class="mono">
		<input type="button" value="Delete Web Wallet" onclick="del_webwallet()">
	<td align="right">
		<input type="button" value="Cancel" onclick="close_editor()">
		<input type="button" value="Save only in browser" onclick="save_web_wallet()">
		<input type="submit" name="save" value="Save wallet & Recalc balance">
</form>
</table>
</div>

<script>
// reaload page on new block
var _lblo = 0
blno.addEventListener("lastblock", function(e) {
	if (_lblo==0) {
		_lblo = e.block.Height
	} else if (e.block.Height!=_lblo) {
		location.reload()
	}
})
</script>
